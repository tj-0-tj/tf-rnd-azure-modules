parameters:
    - name : PERSONS 
      type: object
      default: null
steps:
  - ${{ each item in parameters.PERSONS }}:
     - script: echo '${{ item.key }}=${{ replace(convertToJson(item.value), ':', '=')}}' >> parameters.auto.tfvars
       displayName: "JsonVar ${{ item.key }}"

  - task: Bash@3
    displayName: "Test"
    inputs:
      targetType: inline
      script: |
        cat parameters.auto.tfvars
        echo "${{ convertToJson(parameters.PERSONS) }}"
        
      # env:
      #   ${{ each item in parameters.PERSONS }}:
      #     ${{ format('SCRIPT_PARAM_{0}_KEY', item.index) }}: ${{ item.name }}
      #     ${{ format('SCRIPT_PARAM_{0}_VAL', item.index) }}: ${{ item.age }}
            
        
